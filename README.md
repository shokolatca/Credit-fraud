# Auto Loan Dataset (2021) 
---

## 1) Происхождение и как собирались данные 

- Источник: датасет **Auto Loan Dataset** с Kaggle.
- Единица наблюдения: **один кредит (одна заявка/договор)**.
- Период: **2021 год** (платежи/обновления по кредитам тоже ограничены 2021).
- Поля с датами показывают, что данные представляют собой **регулярные “срезы” (batch snapshots)**:
  - `issue_date` ведёт себя как **дата выгрузки/среза** (значения группируются вокруг 7–11 числа месяца),
  - поэтому `issue_date` **не следует трактовать как дату выдачи кредита**.
- Размер: ~38.6k записей, 24 признака.
- Качество: дубликатов строк нет; пропуски практически отсутствуют (существенно только в `emp_title`).

**Вывод по сбору:** это табличный “портфельный снимок” кредитов за 2021 год, где часть кредитов уже закрыта (Fully Paid / Charged Off), а часть остаётся в статусе Current.

---

## 2) Что есть в данных

Типы признаков:

- **Целевой статус (outcome):**
  - `loan_status`: `Fully Paid`, `Charged Off`, `Current`.

- **Параметры кредита:**
  - `loan_amount`, `term`, `int_rate`, `installment`, `purpose`.

- **Профиль и верификация:**
  - `annual_income`, `verification_status`,
  - `home_ownership`, `address_state`,
  - `emp_length`, `emp_title`,
  - `dti`, `total_acc`,
  - `grade`, `sub_grade`.

- **Поля постфактум/обслуживания (потенциальный leakage для “скоринга до выдачи”):**
  - `total_payment`, `last_payment_date`, `next_payment_date`, `last_credit_pull_date`.

---

## 3) Главные факты из EDA (самое важное)

1) **Дисбаланс классов**: `Charged Off` — меньшинство, поэтому accuracy — плохая метрика; предпочтительны ROC-AUC и особенно PR-AUC.

2) **Сильнейший фактор риска**: `grade/sub_grade` и/или `int_rate` (они отражают кредитный риск-рейтинг).

3) **`issue_date` — не дата выдачи**, а дата батч-среза. Для временной валидации используем месяц/квартал среза и делаем OOT-разбиение аккуратно.

4) **Аномалии консистентности `installment`**:
   - проверка аннуитетной формулой показывает “хвост” несоответствий;
   - введён `installment_mismatch_flag` и sanity-check через оценку “эффективного срока” (`n_eff`).
   - это либо качество данных, либо особый режим расчёта, либо полезный сигнал аномалии.

5) **`emp_title` очень высококардинален**:
   - применяем чистку текста, стоп-слова, биграммы;
   - далее можно извлекать TF‑IDF/эмбеддинги и добавлять как признаки.

---

## 4) Сценарий мошенничества

Явной метки `fraud` нет, поэтому строим **объяснимую гипотезу** мошенничества на основе наблюдаемых паттернов.

### Схема: “First Payment Default / Early Default”
**Идея:** часть заемщиков получает кредит и **почти сразу перестаёт платить** (или делает символический платеж), что похоже на умышленное невозвратное поведение.

Типичные признаки такого поведения в данных:
- `loan_status = Charged Off`,
- очень низкая доля выплаченного: `payment_ratio = total_payment / loan_amount` близка к 0,
- комбинации “подозрительных” заявочных характеристик могут включать:
  - **аномально высокий доход** (иногда без верификации),
  - несоответствия в платежных параметрах (`installment_mismatch_flag`),
  - слабые/редкие паттерны в `emp_title` (сильно “синтетические” формулировки),
  - специфические срезы по регионам/целям (проверяется статистикой).

**Почему это похоже на fraud:** в реальном кредитовании FPD/early-default часто связан с синтетическими/украденными идентичностями и завышением данных заявки. Здесь мы не можем доказать личность, но можем выявлять **подозрительные профили заявок**, которые ведут к “ранним” дефолтам.

---

## 5) Бизнес-задачи (двоякая постановка)

Поскольку явной метки мошенничества нет, используем **две постановки**: одна ближе к классическому скорингу, другая — к антифроду через proxy / аномалии.

### Задача A — скоринговая (credit-risk) с антифрод-акцентом
**Цель:** на этапе заявки оценить риск невозврата (как прокси риска мошенничества/недостоверности данных).

- Target: `loan_status_bin = 1(Charged Off) vs 0(Fully Paid)`  
  (`Current` исключаем или используем только для inference/мониторинга).
- Фичи (только “на момент заявки”):
  - `annual_income`,
  - `dti`, `total_acc`,
  - `loan_amount`, `term`, `purpose`,
  - `verification_status`, `home_ownership`, `address_state`,
  - `emp_length`,
  - `grade/sub_grade` (по решению убираем grade),
  - текстовые фичи из `emp_title`.
- Запрещено (leakage): `total_payment`, платежные даты и производные из них.

**Бизнес-выход:** список заявок “на доп.проверку”, корректировка лимита/ставки, ручная верификация дохода.

---

### Задача B — антифрод через proxy-label / anomaly detection
**Цель:** выявлять *подозрительные* кредиты/заявки, похожие на схему “early default”.

**Вариант B1 (proxy-label):**
- Формируем прокси-метку мошенничества:
  - `fraud_proxy = 1`, если `loan_status=Charged Off` и `payment_ratio < τ` (например, τ=0.1),
  - иначе `fraud_proxy = 0`.
- Обучаем модель, которая по **заявочным** признакам (без leakage) предсказывает вероятность `fraud_proxy`.

**Вариант B2 (без учителя):**
- Обучаем модель обнаружения аномалий (Isolation Forest / One-Class / SOM / autoencoder) на “нормальных” профилях,
- флагируем наиболее аномальные заявки как кандидатов fraud.

**Бизнес-выход:** антифрод-очередь на ручную проверку + правила/триггеры (например, “high income + not verified + mismatch flag”).

---

## 6) Структура проекта

- `eda_financial_loan.ipynb` — EDA.
- `feature_engineering.ipynb` — генерация признаков и итоговый датасет под задачу fraud.
- `train_model.ipynb` — обучение моделей, Optuna, валидация, SHAP/LIME, анализ ошибок.
- `financial_loan.csv` — исходные данные.

---

## 7) Валидация и метрики (что важно)

- Метрики при дисбалансе:
  - **PR-AUC (Average Precision)** — ключевая,
  - ROC-AUC, F1/Recall@precision, confusion matrix.
- Разбиение:
  - учитываем, что `issue_date` — дата среза (батч), поэтому делаем **OOT/temporal split** аккуратно (например, train: ранние месяцы, test: поздние).


## Заметки
`grade/sub_grade/int_rate` - это признаки, близкие к внутреннему скорингу кредитора (они могут “переносить” часть решения кредитора в модель).
